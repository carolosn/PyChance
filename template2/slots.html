<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PyChance - Slots</title>
<link rel="stylesheet" href="static2/style.css">
<style>
/* Slot machine reels */
.slot-container {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 20px auto;
    perspective: 1000px;
}
.slot {
    width: 100px;
    height: 100px;
    background: #111;
    border: 2px solid #00ff99;
    border-radius: 10px;
    font-size: 48px;
    color: #d9ffe7;
    text-align: center;
    line-height: 100px;
    transform-style: preserve-3d;
}
.spin-animate {
    animation: spin 1s ease-in-out;
}
@keyframes spin {
    0% { transform: rotateX(0deg); }
    100% { transform: rotateX(1080deg); }
}

/* Bet input & button */
.bet-container {
    margin-top: 15px;
    text-align: center;
}
.bet-container input {
    width: 120px;
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid #00ff99;
    background: #111;
    color: #d9ffe7;
    font-size: 16px;
    margin-right: 10px;
}
.bet-container button {
    padding: 6px 12px;
    border-radius: 6px;
    border: none;
    background: #00ff99;
    color: #050505;
    font-weight: bold;
    cursor: pointer;
}

/* Game message */
#slotResult {
    margin-top: 15px;
    font-weight: bold;
    color: #fff;
    text-align: center;
}

/* Spin counter */
#spinCounter {
    margin-top: 10px;
    text-align: center;
    font-weight: bold;
    color: #d9ffe7;
}

/* History panel */
.history {
    background: #111;
    padding: 10px;
    border-radius: 8px;
    color: #fff;
}
.history ul {
    list-style: none;
    padding-left: 0;
}

/* Leaderboard */
.leaderboard {
    background: #111;
    padding: 10px;
    border-radius: 8px;
    color: #fff;
    min-width: 150px;
}
.leaderboard h3 {
    margin-top: 0;
}

/* Restart button */
#restartBtn {
    display: block;
    margin: 15px auto;
    padding: 6px 12px;
    border-radius: 6px;
    border: none;
    background: #ff0066;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
}
</style>
</head>
<body>

<header>
    <div class="logo">PyChance</div>
    <div class="user-info">
        User: <span id="usernameDisplay"></span><br>
        Points: <span id="pointsDisplay"></span>
    </div>
</header>

<div class="game-view" style="display:flex; gap:20px; justify-content:center; margin-top:20px;">

    <!-- Leaderboard -->
    <div class="leaderboard">
        <h3>Leaderboard</h3>
        <p>Total Wins: <span id="leaderboardWins">0</span></p>
    </div>

    <!-- Main Game Box -->
    <div class="game-container">
        <h2>Slots</h2>
        <div class="slot-container">
            <div class="slot" id="slot1">?</div>
            <div class="slot" id="slot2">?</div>
            <div class="slot" id="slot3">?</div>
        </div>

        <div class="bet-container">
            <input type="number" id="betAmount" min="1" placeholder="Enter bet">
            <button id="spinBtn" onclick="spinSlots()">Spin</button>
        </div>

        <p id="slotResult"></p>
        <p id="spinCounter">Spin: 0 / 10</p>
        <button id="restartBtn" onclick="restartGame()">Restart</button>

        <div class="rules-box" style="margin-top:20px;">
            <h4>Rules</h4>
            <p>Bet any amount you want.</p>
            <p>If all three slots match, you win your bet.</p>
            <p>If not, you lose your bet.</p>
            <p>After 10 spins, the game will automatically restart.</p>
            <p>This game is based on luck only.</p>
            <p>Good luck!</p>
        </div>

        <a href="homepage.html" class="back" style="display:block; margin-top:10px;">Back</a>
    </div>

    <!-- History -->
    <div class="history">
        <h3>Gaming History</h3>
        <ul id="slotHistory"></ul>
    </div>
</div>

<div class="bottom-buttons" style="text-align:center; margin-top:20px;">
    <a href="login.html" class="logout">Logout</a>
    <a href="mailto:can'thelpyousupport@pychance.com">Need Help?</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
// User data
let username = localStorage.getItem("pychance_user") || "Player1";
let points = parseInt(localStorage.getItem("points") || 50);
document.getElementById("usernameDisplay").textContent = username;
document.getElementById("pointsDisplay").textContent = points;

function updateUserInfo() {
    username = localStorage.getItem("pychance_user") || "Player1";
    points = parseInt(localStorage.getItem("points") || 50);
    document.getElementById("usernameDisplay").textContent = username;
    document.getElementById("pointsDisplay").textContent = points;
}
setInterval(updateUserInfo, 1000);

function changePoints(amount) {
    points += amount;
    if(points < 0) points = 0;
    localStorage.setItem("points", points);
    updateUserInfo();
}

// Leaderboard (persistent)
let totalWins = parseInt(localStorage.getItem('totalWins') || 0);
document.getElementById('leaderboardWins').textContent = totalWins;

let spinCount = 0;
const maxSpins = 10;
const slots = [document.getElementById('slot1'), document.getElementById('slot2'), document.getElementById('slot3')];
const symbols = ["ðŸ’","ðŸ‹","ðŸŠ","ðŸ‡","ðŸ‰"];
const spinCounterDisplay = document.getElementById('spinCounter');

function spinSlots() {
    let bet = parseInt(document.getElementById('betAmount').value);
    if(!bet || bet <= 0) return alert("Enter a valid bet amount!");
    if(bet > points) return alert("You don't have enough points!");

    const results = [];
    const spinDuration = [800, 1000, 1200];

    slots.forEach((slot, i) => {
        slot.classList.remove('spin-animate');
        void slot.offsetWidth;
        slot.classList.add('spin-animate');

        const reelSymbols = [];
        for(let j=0;j<20;j++){
            reelSymbols.push(symbols[Math.floor(Math.random()*symbols.length)]);
        }

        let pos = 0;
        const interval = setInterval(() => {
            slot.textContent = reelSymbols[pos % reelSymbols.length];
            pos++;
        }, 50);

        setTimeout(() => {
            clearInterval(interval);
            const finalSymbol = reelSymbols[Math.floor(Math.random()*symbols.length)];
            slot.textContent = finalSymbol;
            results[i] = finalSymbol;

            if(results.filter(r=>r).length === slots.length){
                const win = results.every(s => s === results[0]);
                const pointsChange = win ? bet : -bet;
                points += pointsChange;
                if(points < 0) points = 0;

                document.getElementById('slotResult').textContent =
                    `Result: ${results.join(" ")} | ${win ? 'You won!' : 'You lost.'} ${pointsChange>0?'+':''}${pointsChange} pts | Total: ${points} pts`;
                localStorage.setItem('points', points);

                if(win) {
                    confetti({particleCount:100, spread:70, origin:{y:0.6}});
                    totalWins++;
                    document.getElementById('leaderboardWins').textContent = totalWins;
                    localStorage.setItem('totalWins', totalWins);
                }

                addHistory(results.join(" "), pointsChange);

                spinCount++;
                spinCounterDisplay.textContent = `Spin: ${spinCount} / ${maxSpins}`;

                if(spinCount >= maxSpins){
                    setTimeout(restartGame, 1500);
                }
            }
        }, spinDuration[i]);
    });

    document.getElementById('betAmount').value = '';
}

// Add spin history
function addHistory(result, pointsChange){
    const li = document.createElement('li');
    li.textContent = `${result} | ${pointsChange>0?'+':''}${pointsChange} pts`;
    document.getElementById('slotHistory').appendChild(li);
}

// Restart game manually or after 10 spins
function restartGame(){
    spinCount = 0;
    slots.forEach(s => s.textContent = '?');
    document.getElementById('slotResult').textContent = '';
    document.getElementById('slotHistory').innerHTML = '';
    spinCounterDisplay.textContent = `Spin: 0 / ${maxSpins}`;
}
// Update username and points anywhere on the page
function updateUserInfo() {
    const username = localStorage.getItem("username") || "Player1";
    const points = localStorage.getItem("points") || 25;

    document.querySelectorAll("#usernameDisplay, #usernameCenter")
            .forEach(el => el.textContent = username);
    document.getElementById("pointsDisplay").textContent = points;
}

setInterval(updateUserInfo, 1000);

function changePoints(amount) {
    let points = parseInt(localStorage.getItem("points") || 25);
    points += amount;
    if (points < 0) points = 0;
    localStorage.setItem("points", points);
    updateUserInfo();
}
</script>
</body>
</html>
